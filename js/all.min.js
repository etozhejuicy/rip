var coreUtils={};function setEventOnRemoveAction(){$('[data-remove], a[href$="#remove"]').off("click.removeAction").on("click.removeAction",function(e){if(!confirm("Вы уверены?"))return e.stopImmediatePropagation(),!1})}function setEventOnSpoilers(){$(".spoiler").find(".title").off("click").on("click",function(){var e=$(this),t=e.parent(".spoiler"),i=t.children(".content");null!=t.attr("data-encode")&&(i.html(decodeURIComponent(escape(window.atob(i.html())))),t.removeAttr("data-encode"),setEventOnTooltipe(),setEventOnSpoilers()),$(this).next().stop().fadeToggle(200,function(){var t=e.find("i");t.hasClass("fa-caret-down")?t.removeClass("fa-caret-down").addClass("fa-caret-up"):t.removeClass("fa-caret-up").addClass("fa-caret-down")})})}function test(e){$("#mouse").text(e)}function setEventOnTooltipe(){$(".tooltipe").off("mouseenter").on("mouseenter",function(e){e.pageX,e.pageY;var t=$(this).attr("data-tooltipe-id"),i=$("#tooltipe-id-"+t);i.fadeIn(200),i.css({left:$(this).position().left+50,top:$(this).position().top+50})}).off("mouseleave").on("mouseleave",function(){var e=$(this).attr("data-tooltipe-id");$("#tooltipe-id-"+e).stop().hide(0)})}function setEventOnRatingSystem(){$("[data-rating-system]").find("a").off("click").on("click",function(){var e=$(this),t=e.parent(),i=e.attr("data-type"),s={record_id:t.attr("data-current-id"),category:t.attr("data-current-category")};s[TOKEN]=formKey,controlLoadIcon("create");var a="like"==i?"rating/like":"rating/dislike";return $.ajax({url:base_url+a,type:"POST",data:s,success:function(i){controlLoadIcon("destroy"),1==i.status&&(e.hasClass("active")?e.removeClass("active"):(t.find("a").removeClass("active"),e.addClass("active")),t.find('a[class*="up"] span').text(i.likes),t.find('a[class*="down"] span').text(i.dislikes)),null!=i.message&&createNotice(i.message)}}),!1})}function subscribe_tag(e){$.ajax({url:"/tag/subscribe_popup/",type:"POST",data:{tag:e},success:function(e){0!=e.status||null==e.message?popup_show(e):createNotice(e.message,"error")}})}function loginPopup(){Core.Popup.create("Авторизация",'<form class="login-popup-form" method="post" action="">\n    <input type="text" id="login_credential" name="login" class="login-popup-form-input" placeholder="Почтовый ящик или имя пользователя">\n    <input type="password" id="login_password" name="password" class="login-popup-form-input" autocomplete="off" minlength="6" placeholder="Пароль">\n    <label style="margin-left: 5px">\n        <input name="remember" id="login_remember_me" type="checkbox" checked>\n        Запомнить меня\n    </label>\n    <button data-loading-icon="fa-circle-o-notch" data-loading-text="Авторизация..." type="submit" class="login-popup-form-input">\n        Вход\n    </button>\n    <div class="login-popup-form-social">\n        <a href="/members/login/steam/" title="Войти через Steam"><i class="fa fa-steam fa-2x"></i></a>\n        <a href="/members/login/vk/" title="Войти через VK"><i class="fa fa-vk fa-2x"></i></a>\n        <a href="/members/login/facebook/" title="Войти через Facebook"><i class="fa fa-facebook fa-2x"></i></a>\n        <a href="/members/login/twitter/" title="Войти через Twitter"><i class="fa fa-twitter fa-2x"></i></a>\n    </div>\n</form>',[{element:"a",prop:{href:"/forum/password-recovery/",text:"Забыли пароль?",class:"login-popup-button"}},{element:"a",prop:{href:"/forum/register/",text:"Зарегистрироваться",class:"login-popup-button"}}])}function countClicks(e,t,i,s){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&a.status},a.open("POST","/click/",!0),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send("position="+t+"&brand="+i+"&country="+s)}$(document).ready(function(){null!=$("#"+TOKEN).data("value")?formKey=$("#"+TOKEN).data("value"):formKey="";$("#page-current-section").data("value"),$("#page-current-address").data("value");setEventOnRemoveAction();var e=!1,t=0;$("#button-move-up").on("click",function(){$("html, body").stop().scrollTop(0)}),$(document).scroll(function(){$(this).scrollTop()>0||e?($("#button-move-up:hidden").fadeIn(0),$(this).scrollTop()>t&&(e=!1,t=0,$("#button-move-up").find("i").removeClass("fa-angle-double-down").addClass("fa-angle-double-up"))):$("#button-move-up:visible").fadeOut(0)}),setEventOnSpoilers(),$("a[class=forum_spoiler_a]").click(function(){$(this).next().slideToggle("fast")}),$(".ajax-notice").click(function(){$(this).fadeOut(200,function(){$(this).remove()})});$("#guideHistory").height();$("#guideHistory").each(function(){$(this).css({height:"144px",overflow:"auto"})}),$(".settingsForHero_skills_single input").change(function(){var e=$(this).attr("name");$("input[name="+e+"]").each(function(){$(this).parent("div").attr("class","settingsForHero_skills_single_radio")}),$(this).parent("div").attr("class","settingsForHero_skills_single_radioON")}),$("#chooseHeroImgs img").each(function(){$(this).click(function(){var e=$(this).attr("id"),t=$(this).attr("data-name"),i=$(this).attr("data-img");$("#themeGuide").html('<img src="'+base_url+"img/heroes/"+i+'/l_icon.jpg" class="guide_themeImg" /><span>'+t+"</span>"),$("#chooseHero .text_spoiler").hide(0),$(".themeGuideHeroId").val(e),$.ajax({url:base_url+"heroes/skillsPosition/"+e,type:"GET",success:function(e){$("#skill_1").attr("src",base_url+"img/heroes/"+i+"/ability"+e.position[0]+".jpg"),$("#skill_2").attr("src",base_url+"img/heroes/"+i+"/ability"+e.position[1]+".jpg"),$("#skill_3").attr("src",base_url+"img/heroes/"+i+"/ability"+e.position[2]+".jpg"),$("#skill_4").attr("src",base_url+"img/heroes/"+i+"/ability"+e.position[3]+".jpg"),$(".new-abilities-block").html(e.abilities),$(".new-ability-value").click(function(){var e=$(this);$('.new-ability-value[data-level="'+e.data("level")+'"]').addClass("muted"),e.removeClass("muted"),$('input[name="new_abilities['+e.data("level")+']"]').val(e.data("number"))}),$(".new-abilities-block").trigger("change")}}),$("#chooseHeroImgs img").each(function(){$(this).parent().attr("style","")}),$(this).parent().css({opacity:"1",border:"1px solid #ff7e00"}),$("input[name=hero_id]").val(e),$("#settingsForHero, #themeGuide").show(),$("#guide_edit_heroSkillBild").css({display:"block"}),$("#guide_edit_heroAll").slideUp("fast"),$("#chooseHero").html("<div class='single-all-guides'><img src='"+base_url+"img/heroes/"+i+"/s_icon.jpg' class='chooseHeroImage' /> <i class='fa fa-close' id='guide_deleteHeroButton'></i> <sup>- выбранный герой, вы можете убрать его щелкнув на крестик</sup></div>"),$("#guide_deleteHeroButton").click(function(){$("#chooseHero").html(""),$("#guide_edit_heroSkillBild").css({display:"none"}),$("input[name=hero_id]").val("0")})})}),$(".new-ability-value").click(function(){var e=$(this);$('.new-ability-value[data-level="'+e.data("level")+'"]').addClass("muted"),e.removeClass("muted"),$('input[name="new_abilities['+e.data("level")+']"]').val(e.data("number"))}),$("#guide_deleteHeroButton").click(function(){$("#chooseHero").html(""),$("#guide_edit_heroSkillBild").css({display:"none"}),$("input[name=hero_id]").val("0")}),$("#crateOrSaveGuideButton").click(function(){$("#editor").sceditor("instance").updateOriginal(),$("#editor").sceditor("instance").val($("#editor").sceditor("instance").val()),$('textarea[name="editor_text_bbcode"]').val($("#editor").sceditor("instance").val()),$('textarea[name="editor_text_html"]').val($("#editor").sceditor("instance").getWysiwygEditorValue(!1)),$("#formAddOrSaveGuide").submit()});var i=0;function s(e){if($("#guide_moreBlocks div[class=single-all-guides]").length<10){var t=i;$("#userBlock1").clone().attr("id","userBlock"+t).appendTo("#guide_moreBlocks"),null==e?$("#userBlock"+t+" input").val(""):$("#userBlock"+t+" input").val(e),$("#userBlock"+t+" textarea").text("").attr("id","guide_textarea"+t),null==$("#userBlock"+t+" a[class=button_delete_block]").attr("class")&&$("#userBlock"+t+" textarea:first").after("<a href='javascript://' class='button_delete_block'>Удалить блок</a>"),$("#userBlock"+t+" a[class=button_delete_block]").click(function(){var e=$(this).parent();confirm("Удалить блок?")&&e.remove()}),$("#userBlock"+t+" a[class=button_up_block]").click(function(){$(this).parent().insertBefore($(this).parent().prev("div"))}),$("#userBlock"+t+" a[class=button_down_block]").click(function(){$(this).parent().insertAfter($(this).parent().next("div"))}),$("#userBlock"+t+" a[class=button_add_block]").click(function(){s()}),publicBBcodes("#userBlock"+t+" div[class=bbcods] > a","id","#userBlock"+t+" textarea","bb","[","]","yes"),publicBBcodes("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_heroes] img","title","#userBlock"+t+" textarea","bb","[hero=","]"),publicBBcodes("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_items] img[title]","title","#userBlock"+t+" textarea","bb","[item=","]"),publicBBcodes("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_colors] div","title","#userBlock"+t+" textarea","colors","[color=","]","yes"),publicBBcodes("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_skills]  div[class=guide_bbcodes_heroes_hide] img","title","#userBlock"+t+" textarea","bb","[skill=","]"),publicBBcodes("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_neutrals] img","title","#userBlock"+t+" textarea","bb","[neutrals=","]"),$("#userBlock"+t+" div[class=bbcods] > div[class=guide_bbcodes_colors] div").click(function(){$(this).parent().parent().slideUp(100)}),$("#userBlock"+t+" div[class=bbcods] > span").click(function(){$("#userBlock"+t+" div[class=bbcods] > div[class!="+$(this).next().attr("class")+"]").hide(0),$(this).next().slideToggle("fast")}),$("#userBlock"+t+" textarea").click(function(){$(this).parent().children("div[class=bbcods]").children("div").slideUp("fast")}),$("#userBlock"+t+" div[class=guide_bbcodes_skills] div[class*=guide_bbcodes_heroes_single] > a").click(function(){$(".guide_bbcodes_heroes_hide").hide(0),$(this).next().fadeIn(200)}),i++}else $("body").append('<div class="messageTopError">Вы не можете создать больше 10 блоков</div>'),$(".messageTopError").delay(4e3).fadeOut(2e3)}i=$("#guide_moreBlocks div[class=single-all-guides]").length,i++,$("#guide_moreBlocks div[class=single-all-guides]").each(function(){publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > a","id","#"+$(this).attr("id")+" textarea","bb","[","]","yes"),publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_heroes] img","title","#"+$(this).attr("id")+" textarea","bb","[hero=","]"),publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_items] img[title]","title","#"+$(this).attr("id")+" textarea","bb","[item=","]"),publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_colors] div","title","#"+$(this).attr("id")+" textarea","colors","[color=","]","yes"),publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_skills]  div[class=guide_bbcodes_heroes_hide] img","title","#"+$(this).attr("id")+" textarea","bb","[skill=","]"),publicBBcodes("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_neutrals] img","title","#"+$(this).attr("id")+" textarea","bb","[neutrals=","]"),$("#"+$(this).attr("id")+" div[class=bbcods] > div[class=guide_bbcodes_colors] div").click(function(){$(this).parent().parent().slideUp(100)}),$("#"+$(this).attr("id")+" div[class=bbcods] > span").click(function(){$("div[class=bbcods] > div[class!="+$(this).next().attr("class")+"]").hide(0),$(this).next().slideToggle("fast")}),$("#"+$(this).attr("id")+" textarea").click(function(){$(this).parent().children("div[class=bbcods]").children("div").slideUp("fast")}),$("#"+$(this).attr("id")+" div[class=guide_bbcodes_skills] div[class*=guide_bbcodes_heroes_single] > a").click(function(){$(".guide_bbcodes_heroes_hide").hide(0),$(this).next().fadeIn(200)})}),$("#guide_moreBlocks .button_delete_block").each(function(){$(this).click(function(){var e=$(this).parent();confirm("Удалить блок?")&&e.remove()})}),$("#guide_moreBlocks .button_down_block").each(function(){$(this).click(function(){$(this).parent().insertAfter($(this).parent().next("div"))})}),$("#guide_moreBlocks .button_up_block").each(function(){$(this).click(function(){$(this).parent().insertBefore($(this).parent().prev("div"))})}),$(".guideInfoBlockInSide a").click(function(){s($(this).text())}),$(".button_add_block").click(function(){s()}),$("#guide_buttonPreview").click(function(){var e=$(this),t=tinyMCE.activeEditor.getContent();e.text("Предпросмотр (Загрузка...)"),$.ajax({url:base_url+"guides/getPreview/",type:"post",data:{html:t},success:function(t){null!=t.html&&($(".guide-preview").html(t.html),e.text("Предпросмотр"),setEventOnTooltipe(),setEventOnSpoilers())}})}),$("#guide_buttonHeroSelect").click(function(){$("div[id=guide_edit_heroAll]").slideToggle("fast")}),$(".guideInfoBlockInSide_delete").click(function(){$(this).parent().fadeOut(1e3)}),publicBBcodes(".forum_message_single_main_title > a[data-name]","data-name","#textareaForReplyInTopic","@"),publicBBcodes(".forum_bbcodes > a","id","#textareaForReplyInTopic","bb","[","]","yes"),publicBBcodes(".forum_bbcodes > div[class=guide_bbcodes_heroes] img","title","#textareaForReplyInTopic","bb","[hero=","]"),publicBBcodes(".forum_bbcodes > div[class=guide_bbcodes_items] img[title]","title","#textareaForReplyInTopic","bb","[item=","]"),publicBBcodes(".forum_bbcodes > div[class=guide_bbcodes_colors] div","title","#textareaForReplyInTopic","colors","[color=","]","yes"),publicBBcodes(".forum_bbcodes > div[class=guide_bbcodes_skills]  div[class=guide_bbcodes_heroes_hide] img","title","#textareaForReplyInTopic","bb","[skill=","]"),publicBBcodes(".forum_bbcodes > div[class=guide_bbcodes_neutrals] img","title","#textareaForReplyInTopic","bb","[neutrals=","]"),$(".forum_bbcodes > span").click(function(){$(".forum_bbcodes > div[class!="+$(this).next().attr("class")+"]").hide(0),$(this).next().slideToggle("fast")}),$(".forum_bbcodes > div[class=guide_bbcodes_colors] div").click(function(){$(this).parent().parent().slideUp(100)}),$("#textareaForReplyInTopic").click(function(){$(".forum_bbcodes").children("div").slideUp("fast")}),$(".forum_bbcodes div[class*=guide_bbcodes_heroes_single] > a").click(function(){$(".guide_bbcodes_heroes_hide").hide(0),$(this).next().fadeIn(200)}),$("a[data-quote]").click(function(){var e=$(this).attr("data-name"),t=$(this).attr("data-quote-id");$.ajax({url:base_url+"forum/main/getPost/"+t,type:"GET",success:function(t){var i=$("#textareaForReplyInTopic").val();""!=i?$("#textareaForReplyInTopic").val(i+"\n[quote="+e+"]"+t+"[/quote]"):$("#textareaForReplyInTopic").val("[quote="+e+"]"+t+"[/quote]"),$("#textareaForReplyInTopic").focus()}})}),$("input[name=serachForum]").focus(function(){"Искать..."==$(this).val()&&$(this).val("")}).blur(function(){""==$(this).val()&&$(this).val("Искать...")}),$(".prices-spoiler").click(function(){$(this).next().slideToggle(200)}),$(".page-slider-main").mouseover(function(){$(this).find(".page-slider").show(0)}).mouseout(function(){$(this).find(".page-slider").hide(0)}),setEventOnRatingSystem(),setEventOnTooltipe();var a=!1;$("#menu-search i").click(function(){var e=$(this).parents("#menu-search").find('input[type="text"]');a?(e.animate({width:0,opacity:0}),a=!1):(e.animate({width:160,opacity:1}),a=!0)}),$(".forum-customization").bind("click",function(){$.ajax({url:base_url+"main/forumCustomization",method:"GET",success:function(e){popup_show(e),$(".forum-customization-form").find('button[class="send"]').off("click").on("click",function(){var e=$(this),t=e.parents(".forum-customization-form"),i=t.find('input[name="node[]"]:not(:checked)'),s=new Array;i.each(function(){s.push($(this).val())});var a=s.join(",");return $.ajax({url:base_url+"main/forumCustomizationSave",type:"POST",data:{nodes:a},success:function(e){if(""==e)return popup_hide(),!1;1==e.status&&popup_hide(),null!=e.message&&createNotice(e.message,"error")}}),!1}),$('input[name="checkall"]').off("click").on("click",function(){var e=$(this).parents(".category");$(this).attr("checked")?e.nextUntil('div[class="category"]').find("input").attr("checked",!0):e.nextUntil('div[class="category"]').find("input").attr("checked",!1)})}})}),$(".news-customization").bind("click",function(){$.ajax({url:base_url+"main/newsCustomization",method:"GET",success:function(e){popup_show(e),$(".forum-customization-form").find('button[class="send"]').off("click").on("click",function(){var e=$(this),t=e.parents(".forum-customization-form"),i=t.find('input[name="category[]"]:not(:checked)'),s=new Array;i.each(function(){s.push($(this).val())});var a=s.join(","),o=t.find('input[name="ads"]').is(":checked")?1:0;return $.ajax({url:base_url+"main/newsCustomizationSave",type:"POST",data:{categories:a,ads:o},success:function(e){1==e.status&&popup_hide(),null!=e.message&&createNotice(e.message,"error")}}),!1})}})}),$(".show-result").off("click").on("click",function(){var e=$(this),t=e.parents(".status");0===t.length&&(t=e.parents(".js-status"));var i=e.attr("data-score");return e.hide(),t.find(".score").text(i),!1}),$(".tournament-grid-arrow").off("click").on("click",function(){var e=$(this).parents(".tournament-grid-wrapper"),t=e.find(".tournament-grid-scroll").data("max-scroll"),i=parseInt(e.find(".tournament-grid-scroll").css("left"));i-200<t?i=t:i-=200,i==t?e.find(".tournament-grid-arrow").fadeOut(200):e.find(".tournament-grid-arrow:hidden").fadeIn(200),i<0&&e.find(".tournament-grid-arrow-back:hidden").fadeIn(200),e.find(".tournament-grid-scroll").animate({left:i+"px"})}),$(".tournament-grid-arrow-back").off("click").on("click",function(){var e=$(this).parents(".tournament-grid-wrapper"),t=e.find(".tournament-grid-scroll").data("max-scroll"),i=parseInt(e.find(".tournament-grid-scroll").css("left"));i+200>0?i=0:i+=200,0==i?e.find(".tournament-grid-arrow-back").fadeOut(200):e.find(".tournament-grid-arrow-back:hidden").fadeIn(200),i>t&&e.find(".tournament-grid-arrow:hidden").fadeIn(200),e.find(".tournament-grid-scroll").animate({left:i+"px"})}),$(".tournament-streams-tubs").find(".tournament-streams-tubs-single").off("click").on("click",function(){$(".tournament-streams-tubs").find(".active").removeClass("active"),$(this).addClass("active"),$(".tournament-streams-list").find(".single").fadeOut(0);var e=$(".tournament-streams-list").find('[data-id="'+$(this).data("id")+'"]');if(1==e.find(".stream").attr("data-encoded")){var t=e.find(".stream");t.html(decodeURIComponent(escape(window.atob(t.html())))),e.find(".stream").attr("data-encoded",0)}$(".tournament-streams-list").find('[data-id="'+$(this).data("id")+'"]').fadeIn(0)}),$(".pagination-select-number-page").on("keydown",function(e){var t=location.protocol+"//"+location.host+location.pathname,i=getUrlParams(),s=$(this).parents(".pagination").attr("data-per-page"),a=parseInt($(this).val());if(!isNaN(a)){a>0&&a--,i.page=s*a;var o=$.map(i,function(e,t){return[t+"="+e]});13==e.keyCode&&(window.location.href=t+"?"+o.join("&"))}}),$(".guides-tactics").find("select").on("change",function(){$(this).parents("form").submit()}),coreUtils.setEventOnTitleTooltipes=function(){$("[data-title-tooltipe]").off("mouseover").on("mouseover",function(){var e=$(this);$(".title-tooltipe").text($(this).attr("data-title-tooltipe")).show(),$(".title-tooltipe").css({left:e.offset().left,top:$(this).offset().top+$(this).height()+5}),null!=e.attr("data-title-tooltipe-left")&&$(".title-tooltipe").css("left",e.offset().left+parseInt(e.attr("data-title-tooltipe-left"))),null!=e.attr("data-title-tooltipe-top")&&$(".title-tooltipe").css("top",e.offset().top+parseInt(e.attr("data-title-tooltipe-top")))}).off("mouseleave").on("mouseleave",function(){$(".title-tooltipe").hide()})},coreUtils.setEventOnTitleTooltipes(),$(".reply-order-buttons").find("a").click(function(){return $(".reply-order-buttons").find("a").removeClass("active"),$(this).addClass("active"),$.ajax({url:"/replies/getList/",type:"post",data:{category:$("#comment-category").data("title"),order:$(this).data("order")},success:function(e){$("#comments-list").html(e.list)}}),!1});var o=null;$(".guides-tactic-search").on("keyup",function(){var e=$(this);clearTimeout(o),""!=e.val()?o=setTimeout(function(){$.ajax({url:base_url+"guides/ajaxTactics?name="+e.val()+"&sort-by="+$(".guides-tactics").find('[name="sort-by"]').val()+"&range="+$(".guides-tactics").find('[name="range"]').val(),type:"get",success:function(e){$(".guides-tactic-list").hide(),$(".guides-tactic-search-list").html(e.view).show()}})},300):($(".guides-tactic-list").show(),$(".guides-tactic-search-list").hide())});var n="";$(".p-content").hasClass("esport-content-match")&&(n="match"),$(".p-content").hasClass("esport-content-map")&&(n="map"),$(".esport-time-zone").click(function(){$.ajax({url:base_url+"esport/match/changeTimeZone/",type:"get",success:function(e){null==e.message?(popup_show(e),$(".popup").find(".send").click(function(){var e=$(".popup").find("select").val(),t=$(".popup").find("select").find(":selected").text();$.ajax({url:base_url+"esport/match/changeTimeZone/",type:"post",data:{timeZone:e},success:function(){$(".esport-time-zone").attr("title",t).find("span").text(t),"match"==n||"map"==n?coreEsportMatch.getMatchListByFilters():(e-=3,e*=3600,$(".m-matches").find("span[data-time]").each(function(){var t=1e3*$(this).data("time")+1e3*e,i=new Date;i.setTime(t);var s=i.getHours(),a=i.getMinutes();s<10&&(s="0"+s),a<10&&(a="0"+a),$(this).text(s+":"+a)}),$(".m-matches").find("div[data-time]").each(function(){var t=1e3*$(this).data("time")+1e3*e,i=new Date;i.setTime(t);var s=i.getMonth()+1,a=i.getDate();s<10&&(s="0"+s),a<10&&(a="0"+a),$(this).text(a+":"+s)})),popup_hide()}})})):createNotice(e.message)}})}),$(document).on("submit",".login-popup-form",function(){var e=$(this),t=e[0].login.value,i=e[0].password.value,s=e[0].remember.checked?1:0,a=e.find("button"),o=a.text();return 0==t.length?(e.login.focus(),createNotice("Введите логин или почтовый ящик"),!1):0==i.length?(createNotice("Введите пароль"),!1):void $.ajax({type:"POST",url:"/forum/api/user/auth",data:JSON.stringify({login:t,password:i,remember:s,silent:!1,referer:window.location.href}),contentType:"application/json",dataType:"json",async:!0,beforeSend:function(){a.prop("disabled",!0).html((a.data("loadingIcon")?'<i class="fa '+a.data("loadingIcon")+' fa-spin"></i>':"")+(a.data("loadingText")?" "+a.data("loadingText"):""))},success:function(e){switch(a.prop("disabled",!1).html(o),e.status){case"success":location.href=e.redirect;break;case"throttle":return void createNotice("Вы исчерпали лимит попыток входа в аккаунт<br>Попробуйте завтра");case"wrongCredentials":return void createNotice("Не корректный логин или пароль<br>После 5 попыток IP адрес будет временно заблокирован")}}})}),$(".site-login").click(function(e){e.preventDefault(),$(this).css("pointer-events","none"),$.ajax({url:base_url+"members/showModalAuth/",type:"get",success:function(e){null==e.message?popup_show(e):createNotice(e.message)}}),setTimeout(function(){$(".site-login").css("pointer-events","all")},200)}),$(document).on("click",".site-logout",function(e){e.preventDefault(),$.ajax({url:base_url+"members/showModalLogout/",type:"get",success:function(e){null==e.message?popup_show(e):createNotice(e.message)}})}),$(document).on("click","#logout-no-btn",function(){popup_hide()}),$(document).on("click","#logout-yes-btn",function(){popup_hide(),$.ajax({url:"/forum/api/user/logout/",type:"POST",success:function(){location.href="/"}})}),$(document).on("click","#site-register",function(e){e.preventDefault(),popup_hide(),$.ajax({url:base_url+"members/showModalRegister/",type:"get",success:function(e){null==e.message?popup_show(e):createNotice(e.message)}})}),$(document).on("keydown",function(e){27==e.keyCode&&Core.Popup.destroy()}),$('form[data-mode="ajax"]').on("submit",function(e){e.preventDefault();var t=$(this).prop("action"),i=$(this).serializeArray(),s=$(this).find('[type="submit"]'),a=s.html();s.html('<i class="fa fa-circle-o-notch fa-spin"></i> Обработка').attr("disabled",""),Core.Ajax.post(t,i,function(e){""!=e.message&&createNotice(e.message),void 0!==e.data.redirect&&(location.href=e.data.redirect)}),s.html(a).removeAttr("disabled")})});
