$(function(){if("Notification"in window){firebase.initializeApp({messagingSenderId:"403602374178"});var e=firebase.messaging();null==localStorage.getItem("sentFirebaseMessagingToken")?$("div#webpush #subscribe").toggle():$("div#webpush #unsubscribe").toggle(),$(document).on("click","#subscribe",function(){e.requestPermission().then(function(){console.log("Разрешение на уведомления получены"),e.getToken().then(function(e){e&&$.post("/ajax/NotificationNewsToken",{token:e,action:"add"},function(o){1==o.status?(localStorage.setItem("sentFirebaseMessagingToken",e),$("div#webpush #unsubscribe, .popup-buttons #unsubscribe").toggle(),$("div#webpush #subscribe, .popup-buttons  #subscribe").toggle()):(createNotice("Произошла ошибка, попробуйте позже"),console.log(o.code))})}).catch(function(e){createNotice("Произошла ошибка, попробуйте позже"),console.log(e)})}).catch(function(e){console.log("Не удалось получить разрешение на уведомления.",e)})}),$(document).on("click","#unsubscribe",function(){e.getToken().then(function(o){e.deleteToken(o).then(function(e){e&&$.post("/ajax/NotificationNewsToken",{token:o,action:"delete"},function(e){1==e.status?(localStorage.removeItem("sentFirebaseMessagingToken"),$("div#webpush #unsubscribe, .popup-buttons #unsubscribe").toggle(),$("div#webpush #subscribe, .popup-buttons  #subscribe").toggle()):(createNotice("Произошла ошибка, попробуйте позже"),console.log(e.code))})})}).catch(function(e){createNotice("Произошла ошибка, попробуйте позже"),console.log(e)})})}});