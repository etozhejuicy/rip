function genPopup(t){var e=t.data(),a=e.action||null,i=e.memeAuthorId||null;"reject"!==a||null!==i?"delete"!==a||null!==i?$.ajax({url:"/memes/getModal/",type:"POST",data:e,success:function(t){popup_show(t)}}):deleteWithoutMessage(t):rejectWithoutMessage(t)}function rejectWithoutMessage(t){var e=t.data("meme-id");$.ajax({url:"/memes/reject/"+e,type:"POST",data:{reject_msg:"-"},complete:function(e){e.hasOwnProperty("responseJSON")&&"success"===e.responseJSON.status?(createNotice("Мем отклонен"),t.parents(".js-meme-single").hide()):createNotice("Ошибка при отклонении мема")}})}function deleteWithoutMessage(t){var e=t.data("meme-id");$.ajax({url:"/memes/remove/"+e,type:"POST",data:{delete_msg:"-"},complete:function(e){e.hasOwnProperty("responseJSON")&&"success"===e.responseJSON.status?(createNotice("Мем удален"),t.parents(".js-meme-single").hide()):createNotice("Ошибка при удалении")}})}function uploadMemeMaterial(t){var e=$("#upload").clone();e.addClass("popup-overlay").removeAttr("style").removeAttr("id").find("form").attr({id:"material_upload"}),popup_show(e[0].outerHTML)}function addMemeMaterialCat(t){var e=$("#create").clone();e.addClass("popup-overlay").removeAttr("style").removeAttr("id").find("form").attr({id:"material_add_cat"}),popup_show(e[0].outerHTML)}$(document).ready(function(){function t(){$(".tags-list").find(".remove").off("click").on("click",function(){$(this).parents(".single").remove()})}function e(){$(".tag-container-list-single").find("i").off("click").on("click",function(){$(this).parents(".tag-container-list-single").fadeOut(200,function(){$(this).remove()})})}function a(){$(".tag-container-input-similar-single").off("click").on("click",function(){$(this).attr("data-id");var t=$(this).find("span").text();$(".tag-container-input").find("input").val(""),$(".tag-container-input-similar").find(".tag-container-input-similar-single").remove(),$(".tag-container").append('<div class="tag-container-list-single"><input type="hidden" value="'+t+'" name="tags[]" />'+t+'<i class="fa fa-times"></i></div>'),e()})}$(".vk-posting").click(function(){var t=$(this),e=t.data("id");return $.ajax({url:base_url+"memes/get_image_for_cross/"+e,type:"GET",success:function(e){alert(e);var a=JSON.parse(e);VK.init({apiId:VK_API_ID}),VK.Auth.login(function(e){VK.Api.call("photos.getWallUploadServer",{group_id:VK_GROUP_ID},function(e){console.log(e.response.upload_url),$.post("/yana/news/getDataFromVkForUploadImage",{action:"upload",upload_url:e.response.upload_url,imglink:a.image},function(e){var i=e;console.log(i),console.log(i.server),console.log(i.hash),console.log(i.photo),VK.Api.call("photos.saveWallPhoto",{group_id:VK_GROUP_ID,server:i.server,hash:i.hash,photo:i.photo},function(e){console.log(e),console.log(e.response[0].id);var i=e.response[0].id;VK.Api.call("wall.post",{message:"",owner_id:-VK_GROUP_ID,from_group:1,attachments:[i,a.link]},function(e){t.hide()})})})})},8196)}}),!1}),$('a[href$="#meme-ban"]').off("click").on("click",function(){var t=$(this),e=t.data("user-id"),a=t.data("meme-id");return $.ajax({url:base_url+"memes/control_ban_form/"+e+"/"+a,type:"GET",success:function(t){popup_show(t),$(".member-memes-ban-form").find('button[class="send"]').off("click").on("click",function(){var t=$(this).parents(".member-memes-ban-form").find("form"),e=t.find('[name="reason"]').val(),a=t.find('[name="member_id"]').val(),i=t.find('[name="meme_id"]').val(),n=t.find('[name="remove_distance"]').val();return $.ajax({url:base_url+"memes/control_ban",type:"POST",data:{member_id:a,meme_id:i,remove_distance:n,reason:e},success:function(t){""!=t&&(1==t.status&&window.location.replace(base_url+"forum/members/"+a+"/warn"),null!=t.message&&createNotice(t.message,"error"))}}),!1})}}),!1}),$(document).on("click",".meme-image-gif",function(){var t=$(this).attr("data-img-name");return $(this).find(".meme-image-preview-image-overlay").is(":hidden")?($(this).find("i").stop().fadeIn(100),$(this).find(".meme-image-preview-image-overlay").stop().fadeIn(100),$(this).find("img").attr("src",t+".jpg")):($(this).find("i").stop().fadeOut(100),$(this).find(".meme-image-preview-image-overlay").stop().fadeOut(100),$(this).find("img").attr("src",t+".gif")),!1}),$(document).on("click",".tags-edit",function(){var t=$(this).parents(".tags-wrapper");$(this).fadeOut(0),t.find(".b-tags a").remove(),t.find(".tags-editing").fadeIn(200)}),t(),$(".tag-add-link").click(function(){var e=$(".tag-add-input");if(""==e.val())return!1;if($(".tags-list").find(".single").size()>=5)return createNotice("Тегов не может быть больше 5","error"),!1;var a=$(".clones").find(".single").clone();return a.find("span").text(e.val()),a.find("input").val(e.val()),$(".tags-list").find(".clb").before(a),t(),e.val(""),e.focus(),!1}),$(document).on("click",".tag-save-button",function(){var t=$(this).parents(".tags-wrapper").find(".b-tags"),e=$(this).data("id"),a=$(this).parents(".tags-editing").find('.tag-container-list-single input[name="tags[]"]').serialize();$.ajax({url:base_url+"memes/tagsUpdate/"+e,type:"post",data:a,success:function(e){var a=$(e);t.html(a[0].innerHTML),$(".tags-editing").fadeOut(0),$(".tags-edit").fadeIn(200)}})}),e(),a(),$(".tag-container-input-plus").click(function(){if(""==$(".tag-container-input").find("input").val())return!1;var t="moderate",a='title="Данного тега нет в базе данных, он будет отправлен на модерацию."',i=$(".tag-container-input").find("input").val();return $.ajax({url:"/tag/getExact",type:"post",data:{text:i,category:"meme"},success:function(e){"1"===e&&(t=a=""),$(".tag-container").append('<div class="tag-container-list-single '+t+'" '+a+'><input type="hidden" value="'+i+'" name="tags[]" />'+i+'<i class="fa fa-times"></i></div>')}}),e(),$(".tag-container-input").find("input").val(""),$(".tag-container-input-similar").find(".tag-container-input-similar-single").remove(),!1});var i=null;$(".tag-container-input").find("input").keyup(function(){var t=$(this);if(clearTimeout(i),""==t.val())return $(".tag-container-input-similar").find(".tag-container-input-similar-single").remove(),!1;i=setTimeout(function(){$.ajax({url:base_url+"tag/getSimilar",type:"post",data:{text:t.val(),category:t.attr("data-category")},success:function(t){$(".tag-container-input-similar").html(t.view),a()}})},150)}),$(".data-meme-random-refresh").click(function(){$(this);$.ajax({url:base_url+"memes/getRandom",type:"get",success:function(t){$(".meme-random-wrapper").html(t),commentsInit(),setEventOnRatingSystem()}})}),$("#tags .single .control a").on("click",function(){var t=$(this).data(),e=$(this).parent().parent();"accept"==t.action||"reject"==t.action?$.ajax({url:"/memes/tag_action",type:"post",data:t,success:function(){e.remove()}}):"edit"==t.action&&e.find(".b-tags span").toggle()}),$('#tags .single .b-tags a[data-action="save"]').on("click",function(){var t=$(this).parent().parent().parent(),e=$(this).data();e.tag=$(this).prev().val(),$.ajax({url:"/memes/tag_action",type:"post",data:e,success:function(){t.remove()}})}),$('a[data-action="toggle"]').on("click",function(){var t=$(this).find("i"),e=$(this).parent().children("[data-item]");return e.slideToggle(200),t.hasClass("fa-caret-down")?(t.removeClass("fa-caret-down").addClass("fa-caret-up"),$(this).next().show()):($(this).next().hide(),t.removeClass("fa-caret-up").addClass("fa-caret-down"),e.find("[data-item]").hide(),e.find("i.fa.fa-caret-up").removeClass("fa-caret-up").addClass("fa-caret-down")),!1}),$(".scroll[data-direction]").on("click",function(){var t,e=$(this),a=e.parent().find(".slider"),i=a.find("article.item.active");"prev"==e.data("direction")&&(t=0==i.prev().length?a.find("article:last"):i.prev()),"next"==e.data("direction")&&(t=0==i.next().length?a.find("article:first"):i.next()),i.fadeOut(500,function(){i.removeClass("active"),t.fadeIn(500).addClass("active").removeAttr("style")})});$('.filters input[name="tag"]').on("keyup",function(){var t=$(this);if(clearTimeout(i),""==t.val())return $(".tag-container-search-similar").empty(),!1;setTimeout(function(){$.ajax({url:"/tag/getSimilar",type:"post",data:{text:t.val(),category:"meme"},success:function(t){$(".tag-container-search-similar").html(t.view)}})},250)}).on("blur",function(){setTimeout(function(){$(".tag-container-search-similar").empty()},500)}),$(".tag-container-search-similar").on("click",".tag-container-input-similar-single",function(){$('.filters input[name="tag"]').val($(this).find("span").text()).trigger("change"),$(this).parent().empty()}),$('[data-meme-edit="source"] a').on("click",function(){var t=$(this),e=t.parent().find("input");t.fadeOut(0),e.fadeIn(200),e.focus()}),$('[data-meme-edit="source"] input').on("focusout submit",function(){var t=$(this),e=t.parent().find("a");t.fadeOut(0),e.fadeIn(200),$.ajax({url:"/memes/updateSource/"+t.data("memeId"),method:"POST",data:{source:t.val()},beforeSend:function(){e.html('<i class="fa fa-circle-o-notch fa-spin fa-fw"></i> Обработка...')},success:function(a){if(0!=a.error)return createNotice(a.error),e.fadeOut(0),t.fadeIn(200),void t.focus();t.fadeOut(0),e.fadeIn(200),e.html(a.source)}})}),$(document).on("click",".material-nav > a[data-cat-id], .materials-cats > a[data-cat-id]",function(){var t=$(this).data("catId");$.ajax({url:"/memes/material/"+t,beforeSend:function(){$(".p-content").fadeOut(0)},success:function(e){e=$(e);$(".p-content").html(e.find(".p-content").html()).fadeIn(500),history.pushState(null,null,"/memes/material/"+t)}})}),$(document).on("click","[data-material-remove]",function(){var t=$(this).data("materialRemove"),e=$(this);$.ajax({url:"/memes/material_action/"+t+"/remove",success:function(t){0==t.error&&e.parents(".material").remove(),createNotice(t.message)}})}),$('[data-action="accept-material-cat"], [data-action="reject-material-cat"]').on("click",function(){var t=$(this);$.ajax({url:"/memes/material_cat_action/"+t.data("id")+"/"+("accept-material-cat"==t.data("action")?"accept":"reject"),success:function(e){0==e.error&&t.parents(".category").remove(),createNotice(e.message)}})}),$('[data-action="edit-material-cat"]').on("click",function(){var t=$(this),e=$("#edit_cat").clone();e.addClass("popup-overlay").removeAttr("style").removeAttr("id").find("form").attr({id:"material_cat_edit",action:"/memes/material_cat_action/"+t.data("id")+"/edit"}).find("input").attr({value:t.data("title")}),e.find('option[value="'+t.data("parent")+'"]').attr({selected:!0}),popup_show(e[0].outerHTML)}),$('[data-action="edit-material"]').on("click",function(){var t=$(this),e=$("#edit_material").clone();e.addClass("popup-overlay").removeAttr("style").removeAttr("id").find("form").attr({id:"material_edit",action:"/memes/material_action/"+t.data("id")+"/edit"}).find('option[value="'+t.data("parent")+'"]').attr({selected:!0}),popup_show(e[0].outerHTML)})});var filterChange=debounce(function(){var t=$(this),e=t.serialize();Core.Ajax.post("/memes/ajaxList?"+e,{page:t.data("page")},function(t){if("success"===t.status){var e=$(".js-memes-list"),a=e.siblings(".pagination");a.length?a.replaceWith(t.data.pagination):e.after(t.data.pagination),e.replaceWith(t.data.list)}})},250);$(".js-memes-filter").change(filterChange);
