$(document).ready(function(){function n(e){return a*e/100+"px"}function c(e){return parseInt(n(e))/1.78+"px"}var s=$(".streams-index"),t=($(".streams-view"),$("#streams-list")),a=$("#player-chat").parents(".p-content").innerWidth();if($('.button-rules input[type="checkbox"]').on("change",function(){$(this).prop("checked")?$(".loginByTwitch").fadeIn(200):$(".loginByTwitch").fadeOut(100)}),s.find(".filters select").change(function(){var e=s.find(".filters form").serialize();return $.ajax({url:base_url+"streams/get_list?"+e,type:"GET",success:function(e){""!=e&&t.html(e)}}),!1}),$('[data-action="report"]').on("click",function(){var e=$(this).attr("data-id");$.ajax({url:base_url+"streams/report_popup/"+e,type:"GET",success:function(e){popup_show(e),$(".stream-report-form").find(".send").on("click",function(){var e=$(this).parents(".stream-report-form"),s=e.find('input[name="stream_id"]').val(),t=e.find('input[name="reason"]:checked').val();isset(t)||(t=e.find("textarea").val()),isset(s)&&!empty(s)&&isset(t)&&!empty(t)||createNotice("Вы заполнили не все поля"),$.ajax({url:base_url+"streams/report",type:"POST",data:{stream_id:s,reason:t},success:function(e){isset(e.status)&&1==e.status&&($(".popup-overlay").remove(),$("[data-stream-report]").remove()),isset(e.message)&&!empty(e.status)&&createNotice(e.message)}})})}})}),$(".stream-size-buttons").find("a").click(function(){if($(this).hasClass("active")&&null==$(this).data("trigger"))return!1;null==$(this).data("trigger")&&($(".stream-size-buttons").find("a").removeClass("active"),$(this).addClass("active"));var e=$(".stream-size-buttons").find(".active").data("size");if($("#stream-chat").is(":visible"))var s=1;else s=0;var t;$("#player-chat").parents(".p-content").innerWidth();switch($(this).data("size")){case 1:$("#stream-mobile").removeClass("stream-full"),$("#player-chat").removeClass("stream-full"),t=$("#stream-chat").is(":visible")?70:100,$("#stream-player").animate({width:n(t),height:c(t)},0),$("#stream-chat").animate({width:"30%",height:c(t)},0);break;case 2:$("#stream-mobile").removeClass("stream-full"),$("#player-chat").removeClass("stream-full"),t=100,$("#stream-player").animate({width:n(t),height:c(t)},0),$("#stream-chat").animate({width:"100%",height:"500px"},0);break;case 3:$("#stream-mobile").addClass("stream-full"),$("#player-chat").addClass("stream-full");var a=$(window).height()-50,i=$(window).width();if($("#stream-chat").is(":visible"))var r=i-351;else r=i;$("#stream-player").animate({width:r+"px",height:a+"px"},0),$("#stream-chat").animate({width:"351px",height:a+"px"},0);break;case 4:if($("#stream-chat").is(":visible")){if(1==e)$("#stream-player").animate({width:n(100),height:c(100)},0);else if(3==e){r=i=$(window).width();$("#stream-player").animate({width:r+"px"},0)}$(this).removeClass("on"),s=0}else{if(1==e)$("#stream-player").animate({width:n(70),height:c(70)},0),$("#stream-chat").animate({height:c(70)},0);else if(3==e){r=(i=$(window).width())-351;$("#stream-player").animate({width:r+"px"},0)}$(this).addClass("on"),s=1}$("#stream-chat").slideToggle(0)}return null!=$(".stream-size-buttons").data("update")&&$.ajax({url:base_url+"streams/updateSettings",type:"POST",data:{size:e,chat:s},success:function(e){}}),!1}),null!=$("#stream-mobile").attr("class")){if($(window).width()<767){var e=$(".stream-size-buttons .min-size"),i=$(".stream-size-buttons .medium-size");e.hasClass("active")&&(e.removeClass("active"),i.addClass("active"))}if($("#stream-mobile").hasClass("stream-full")){var r=0,l=$(window).height()-47,m=$(window).width();if($("#stream-chat").is(":visible"))var u=m-351;else u=m;$("#stream-player").animate({width:u+"px",height:l+"px"},r),$("#stream-chat").animate({width:"351px",height:l+"px"},r)}else{switch($(".stream-size-buttons").find(".active").data("size")){case 1:$("#stream-mobile").hasClass("stream-full")&&($("#stream-mobile").appendTo("#stream-content-dynamic"),$("#stream-mobile").removeClass("stream-full")),$("#stream-chat").is(":visible")?$("#stream-player").animate({width:n(70),height:c(70)},r):$("#stream-player").animate({width:n(100),height:c(100)},r),$("#stream-chat").animate({width:"30%",height:c(70)},r);break;case 2:$("#stream-mobile").hasClass("stream-full")&&($("#stream-mobile").appendTo("#stream-content-dynamic"),$("#stream-mobile").removeClass("stream-full")),$("#stream-player").animate({width:n(100),height:c(100)},r),$("#stream-chat").animate({width:"100%",height:"500px"},r)}}}function o(){$(".stream-subscribe").off("click.subscribePpopup").on("click.subscribePpopup",function(){var e=$(this).attr("data-id");return $.ajax({url:base_url+"streams/subscribe_popup/"+e,type:"GET",success:function(e){popup_show(e),$(".stream-subscribe-form").find(".send").on("click",function(){var e=$(this).parents(".stream-subscribe-form"),s=e.find('input[name="stream_id"]').val(),t=e.find('input[value="site"]').is(":checked"),a=e.find('input[value="email"]').is(":checked");isset(s)&&(t||a)||createNotice("Вы заполнили не все поля"),$.ajax({url:base_url+"streams/subscribe/"+s,type:"POST",data:{site:t,email:a},success:function(e){isset(e.status)&&1==e.status&&($(".popup-overlay").remove(),$(".stream-subscribe").html('<i class="fa fa-bullhorn"></i> Отписаться').removeClass("stream-subscribe").addClass("stream-unsubscribe").off("click.subscribePpopup"),h()),isset(e.message)&&!empty(e.status)&&createNotice(e.message)}})})}}),!1})}function h(){$(".stream-unsubscribe").off("click.unsubscribe").on("click.unsubscribe",function(){var e=$(this).attr("data-id");return $.ajax({url:base_url+"streams/unsubscribe/"+e,type:"GET",success:function(e){isset(e.message)&&!empty(e.status)&&createNotice(e.message),$(".stream-unsubscribe").html('<i class="fa fa-bullhorn"></i> Подписаться').removeClass("stream-unsubscribe").addClass("stream-subscribe").off("click.unsubscribe"),o()}}),!1})}$(".disable-stream").click(function(){var t=$(this),e=$(this).data("id");return $.ajax({url:base_url+"streams/visibleOnMainPage/"+e,type:"POST",success:function(e){if(1!=e.status)createNotice(e.message);else{var s=t.find("i");s.hasClass("fa-eye-slash")?(s.removeClass("fa-eye-slash").addClass("fa-eye"),t.find("span").text("скрыть с главной")):(s.removeClass("fa-eye").addClass("fa-eye-slash"),t.find("span").text("показать на главной"))}}}),!1}),o(),h(),$(".stream-spoiler-title").click(function(){if(-1==$(this).data("id"))return createNotice("Войдите или зарегистрируйтесь, чтобы вы смогли воспользоваться данными удобствами."),!1}),$(".streams-list-subscription").find(".unsubscribe").find("a").click(function(){var s=$(this).parents(".single-subscription"),e=$(this).data("id");return $.ajax({url:base_url+"streams/unsubscribe/"+e,type:"GET",success:function(e){isset(e.message)&&!empty(e.status)&&createNotice(e.message),s.fadeOut(200)}}),!1}),$(".stream-subs-settings").find("a").click(function(){return $.ajax({url:base_url+"streams/subscription_popup/",type:"GET",success:function(e){popup_show(e),$(".stream-subscription-form").find(".send").on("click",function(){var e=$(this).parents(".stream-subscription-form"),s=e.find('input[value="site"]').is(":checked"),t=e.find('input[value="email"]').is(":checked");s||t||createNotice("Вы заполнили не все поля"),$.ajax({url:base_url+"streams/subscription_processing/",type:"POST",data:{site:s,email:t},success:function(e){isset(e.status)&&1==e.status&&$(".popup-overlay").remove(),isset(e.message)&&!empty(e.status)&&createNotice(e.message)}})})}}),!1})});
