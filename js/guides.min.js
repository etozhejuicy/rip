$(document).ready(function(){var a=$(".guide-html-content").find(".spoiler");$(".b-view").find(".open-spoilers").find("a").on("click",function(){if($(this).attr("data-clicked")==undefined){$(this).attr("data-clicked","true").text("Закрыть все споилеры");
}else{$(this).removeAttr("data-clicked").text("Открыть все споилеры");}a.find(".title").trigger("click");return false;});$(".p-guides .filters form select").change(function(){var e=$(this);
var d=e.parents("form");var b=d.find('[name="hero_id"]').val();var c=d.find('[name="sort-by"]').val();$.ajax({url:base_url+"guides/get_guides?sort_by="+c+"&hero_id="+b,type:"GET",success:function(f){$("#guides-list").html(f);
}});});$("#heroes a[data-id]").on("click",function(){var b=$(this).data("id");$.ajax({method:"post",url:"/guide/getHeroInfo",data:{hero_id:b},dataType:"json",success:function(c){if(c.error==1){return;
}$('input[name="hero_id"]').val(b);$("#heroes").hide();$('[data-step="1"]').show();$('[data-step="3"]').append(c.step_3);$('[data-step="4"]').append(c.step_4);
$(".guide-steps").removeAttr("style");$(".guide-steps").next().removeAttr("style");$(".control").removeAttr("style");$('.guide-steps [data-step-button="1"]').addClass("active");
}});});$("[data-step-button]").on("click",function(){var b=$(this).data("step-button");$("[data-step-button]").removeClass("active");$('[data-step-button="'+b+'"]').addClass("active");
$("[data-step]").hide();$('[data-step="'+b+'"]').removeAttr("style");});$(".guide-steps:last [data-step-button]").on("click",function(){var b=$(".guide-steps:first").offset().top;
if(window.pageYOffset<b){return false;}$("html, body").animate({scrollTop:b},500);});$(document).on("click","[data-add-build]",function(e){e.preventDefault();
var d=$(this).parent();var b=d.find(" > .row").length;var c=d.find(".row:first").clone();c.find('input:not([type="radio"])').val("");c.find('input[type="radio"]').prop("checked",false);
c.find("input").each(function(){this.name=this.name.replace("[0]","["+b+"]");});c.find("textarea").val("");c.find("textarea").attr("name",c.find("textarea").attr("name").replace("[0]","["+b+"]"));
c.find("label").removeClass("active");c.find("div:has([data-item-id])").remove();c.append('<a class="remove" href="javascript://" onclick="removeRow($(this))"><i class="fa fa-times"></i></a>');
$(this).before(c);});$(document).on("click","label",function(){$(document).find('label:has(input[name="'+$(this).find("input").attr("name")+'"])').removeClass("active");
$(this).addClass("active");});$("[data-add-input]").on("click",function(b){b.preventDefault();$(this).before('<div class="input"><input type="text" name="'+$(this).data("input-name")+'"><a href="javascript://" onclick="removeRow($(this))"><i class="fa fa-times"></i></a></div>');
});$(document).on("click","[data-add-item]",function(){if($(this).parent().find(".item_list").length>0){$(this).parent().find(".item_list").remove();return;
}$(".item_list:visible").remove();var b=$(".item_list:last").clone();b.removeAttr("style");$(this).after(b);});$(document).on("click",".item_list [data-item-id]",function(){var c=$(this).parents(".row");
var d=$(this).data("item-id");var b=c.find(".title input").attr("name");b=b.replace("[name]","[item][]");c.find("[data-add-item]").before('<div class="item">'+$(this).context.outerHTML+' <a class="remove" href="javascript://" onclick="removeRow($(this))"><i class="fa fa-times"></i></a></div>');
c.find(".inputs").append('<input type="hidden" name="'+b+'" value="'+d+'">');});$('[data-step="6"]').on("click","[data-add-synergy]",function(){if($(this).parents(".row").next(".heroes_list").length>0){$(this).parents(".row").next(".heroes_list").remove();
return;}var b=$('[data-step="6"]').find(".heroes_list:last").clone();b.removeAttr("style");$(this).parents(".row").after(b);}).on("click","[data-hero-synergy-id]",function(){var c=$(this).parents(".heroes_list");
var d=c.prev(".row");var b=d.find("textarea").attr("name");b=b.replace("[text]","[hero][]");d.find(".col:first .heroes .button").before('<div><img src="/img/heroes/'+$(this).data("hero-synergy-name")+'/icon.jpg"><a href="javascript://" onclick="removeRow($(this))" class="remove"><i class="fa fa-times"></i></a> <input type="hidden" name="'+b+'" value="'+$(this).data("hero-synergy-id")+'"></div>');
c.remove();});$("[data-add-synergy]").on("click",function(e){e.preventDefault();var d=$(this).parent().find(".row:first").clone();var c=$(this).parent().find(".row").length;
var b=d.find("textarea");b.attr("name",b.attr("name").replace("[0]","["+c+"]"));d.find(".heroes div:not(.button)").remove();d.append('<a href="javascript://" onclick="removeRow($(this))" class="remove"><i class="fa fa-times"></i></a>');
$(this).before(d);});$('.slider input[type="range"]').on("input",function(){var c=$(this).val();var b=$(this).parents(".hero_stats").find(".info > div");
$(this).parents(".slider").find(".level").text("Уровень "+c);b.each(function(){var d=$(this).data();if(d.type=="hp"){$(this).find(".value").text(d.baseValue+(Math.floor(d.startAtribute+d.attributePerLevel*(c-1)))*20);
}else{if(d.type=="hp_regen"){$(this).find(".value").text("+"+(d.baseValue*(1+Math.floor(d.startAtribute+d.attributePerLevel*(c-1))*(5/700))).toFixed(1));
}else{if(d.type=="mp"){$(this).find(".value").text((Math.floor(d.attributePerLevel*(c-1))+d.startAtribute)*12+75);}else{if(d.type=="mp_regen"){$(this).find(".value").text("+"+(d.baseValue+((Math.floor(d.startAtribute+d.attributePerLevel*(c-1)))*2)/100).toFixed(1));
}else{if(d.type=="as"){$(this).find(".as_val .value").text(100+Math.floor(d.startAtribute+d.attributePerLevel*(c-1)));$(this).find(".bat_val .value").text(Math.round(d.baseValue/((100+Math.round(d.startAtribute+d.attributePerLevel*(c-1)))*0.01)*100)/100);
$(this).find(".aps_val .value").text(Math.round(((100+d.startAtribute+d.attributePerLevel*(c-1))*0.01)/d.baseValue*1000)/1000);}else{if(d.type=="armor"){$(this).find(".value").text((d.baseValue+(d.attributePerLevel*(c-1)*(1/6))).toFixed(2));
}else{if(d.type=="dmg"){$(this).find(".value").text(d.baseValue+d.startAttribute+Math.round(d.attributePerLevel*(c-1)));}}}}}}}});});$(document).mouseup(function(c){var b=$(".item_list:not(:last)");
if(b.has(c.target).length===0&&c.target.className!="item_list"&&c.target.parentElement.className!="add_item"){b.remove();}});$("[data-step-toggle]").on("click",function(){var c=$(".guide-steps .active").data("step-button");
var b=$(this).data("step-toggle");var d=1;if(c==1&&b=="prev"){return false;}if(c==7&&b=="next"){return false;}if(b=="next"){d=c+1;}else{d=c-1;}$("[data-step-toggle]").removeAttr("style");
if(d==1){$('[data-step-toggle="prev"]').css({opacity:"0.5"});}if(d==7){$('[data-step-toggle="next"]').css({opacity:"0.5"});}$('[data-step="'+c+'"]').hide();
$('[data-step="'+d+'"]').removeAttr("style");$("[data-step-button]").removeClass("active");$('[data-step-button="'+d+'"]').addClass("active");});});function removeRow(a){if(a.prev().data("item-id")){a.parents(".row").find('.inputs input[value="'+a.prev().data("item-id")+'"]:first').remove();
}a.parent().remove();}